---
layout: post
title: C++ библиотека для работы с Windows Services.
category: C++
tags: c++, windows services
author: gaHcep
year: 2014
month: 8
day: 03
published: true
summary: Библиотека для работы с Windows сервисами. Поддержка UNICODE, грамотный dllimport/dllexport
---

# WinServiceRunner
Кратко о небольшой библиотеке позволяющей устанавливать, удалять, запускать и останавливать сервисы из-под Windows.

**WinServiceRunner** - это C++ библиотека, собранная из-под Microsoft Visual Studio 2013, основная цель которой, как уже было сказано, является предоставление функционала по работе с Windows сервисами, как уже установленными в системе, так и представленными ***.exe** файлами. Выход библиотеки - DLL файл. 

Что библиотека **может**:

 * Устанавливать/удалять сервисы написанные как на C++, так и на C#
 * Возвращать текущий статус сервиса
 * Запускать/останавливать/приостанавливать искомый сервис

Что библиотека **не может**:

 * Работать с несколькими сервисами зависящими друг о друга
 * Передавать аргументы при запуске сервиса

**Типы проектов**

 * **Native** - исходная библиотека на C++  
 * **Managed/ServiceInstallerManaged** - обертка на C# через использование P/Invoke

**Настройка "нативного" проекта**

* Препроцессорная директива **LIBRARY_API**  
 
Явно объявлена в: 
>"Project Settings" -> "C/C++" -> "Preprocessor" -> "Preprocessor definitions".
   
Если определена, то равна **\_\_declspec(dllexport)**, иначе **\_\_declspec(dllimport)**.

* Препроцессорная директива **DLL_IMPORT**

Имеет смысл только в случае если **LIBRARY_API** не определена, так как служит своеобразным декоратором для функций являющихся внутренними.

* Препроцессорная директива **STRING_ENCODING**

Является алиасом к типу **char** либо **wchar_t** в зависимости от того, определена ли директива **UNICODE**.

**Повышение привилегий запуска**

Некоторые сервисы могут быть запущены или приостановлены только под учетной записью Администратора системы либо с привилегиями администратора. 

Это может быть сделано программно - запустить отдельный процесс с повышенными привилегиями (UAC запрос) как на С++, так и на C#. Однако, есть другой способ это сделать - явно указать что библиотека должна быть запущены с повышенными привилегиями. Установите опцию **UAC Execution Level** в:

> **requireAdministrator (/level='requireAdministrator')**: 

Сама настройка может быть найдена тут:

> "Configuration Properties" -> "Linker" -> "Manifest File"

---

## Ссылки

1. [WinServiceRunner на GitHub](https://github.com/gahcep/WinServiceRunner/)


